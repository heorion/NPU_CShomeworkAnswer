## 1.2
- a-通过流水线提高性能
- b-通过并行提高性能
- c-通过预测提高性能
- d-存储层次
- e-通过冗余提高可靠性
- f-加速大概率事件
- g-使用抽象简化设计

## 1.3
1. 程序员使用高级程序语言编写程序
2. 编译器将程序编译为汇编语言
3. 汇编器将汇编语言汇编为二进制机器语言程序，二进制机器语言程序可以在计算机处理器上执行

## 1.5
#### a
P1:
$$3*10^9/1.5 = 2*10^9$$
P2:
$$2.5*10^9/1 = 2.5*10^9$$
P3:
$$4*10^9/2.2 = 1.818*10^9$$
综上所述，P2每秒钟执行指令条数最多，性能最好
#### b
P1:
时钟周期：
$$3*10^9*10 = 3*10^{10}$$
指令数：
$$3*10^{10}/1.5 = 2*10^{10}$$
P2:
时钟周期：
$$2.5*10^9*10 = 2.5*10^{10}$$
指令数：
$$2.5*10^{10}/1 = 2.5*10^{10}$$
P3:
时钟周期：
$$4*10^9*10 = 4*10^{10}$$
指令数：
$$4*10^{10}/2.2 = 1.818*10^{10}$$
#### c
P1:
$$CPI_{new}=1.5*1.2=1.8$$
设新时钟频率为h
$$\frac{1.8}{h} = \frac{1.5}{3G}*0.7$$
解得h = 5.14G
P2:
$$CPI_{new}=1*1.2=1.2$$
设新时钟频率为h
$$\frac{1.2}{h} = \frac{1}{2.5G}*0.7$$
解得h = 4.29G
P3:
$$CPI_{new}=2.2*1.2=2.64$$
设新时钟频率为h
$$\frac{2.64}{h} = \frac{2.2}{4G}*0.7$$
解得h = 6.86G

## 1.7
#### a
P1:
$$CPI_1 = 1*0.1+2*0.2+3*0.5+3*0.2 = 2.6$$
P2:
$$CPI_2 = 2*0.1+2*0.2+2*0.5+2*0.2 = 2$$

#### b
P1:
$$circle_1 = 1 * 10^6 * CPI_1 = 2.6 * 10^6$$
P2:
$$circle_2 = 1 * 10^6 * CPI_2 = 2 * 10^6$$

#### 用时
P1:
$$time_1 = circle_1/f_1 = 2.6 * 10^6 / 2.5Ghz \approx 1.04*10^{-3}s$$
P2:
$$time_2 = circle_2/f_2 = 2 * 10^6 / 3Ghz \approx 6.6*10^{-4}s$$

综上所述，P2更快

## 1.8
#### a
处理器频率：
$$f = 1s/1ns = 1Ghz$$
A:
$$CPI_A = \frac{执行时间_A}{指令数_A*时钟周期} = \frac{1.1s}{1*10^9*1ns} = 1.1$$
B:
$$CPI_B = \frac{执行时间_B}{指令数_B*时钟周期} = \frac{1.5s}{1.2*10^9*1ns} = 1.25$$

#### b
$$\frac{T_1}{T_2} = \frac{CPI_2*指令数_2}{CPI_1*指令数_1}=\frac{1.25*1.2*10^9}{1.1*1*10^9} \approx 1.36 $$

- A处理器的时钟周期长度是B处理器的1.36倍
#### c
- 此处假设使用第一小问中的处理器，时钟周期长度为1ns
$$CPUtime_c = 指令数_c*CPI_c*时钟周期_c = 6*10^8*1.1*1ns = 0.66s$$
- 相对于A的加速比
$$\frac{CPUtime_a}{CPUtime_c} = \frac{1.1}{0.66} \approx 1.67$$
- 相对于B的加速比
$$\frac{CPUtime_b}{CPUtime_c} = \frac{1.5}{0.66} \approx 2.27$$


## 1.10
#### 1.10.1
1:
$$time_1 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{1*2.56*10^9+12*1.28*10^9+5*2.56*10^8}{2Ghz} = 9.6s$$

2:
$$time_2 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{1*2.56*10^9/(0.7*2)+12*1.28*10^9/(0.7*2)+5*2.56*10^8}{2Ghz} = 7.04s$$

4:
$$time_4 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{1*2.56*10^9/(0.7*4)+12*1.28*10^9/(0.7*4)+5*2.56*10^8}{2Ghz} = 3.84s$$

8:
$$time_8 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{1*2.56*10^9/(0.7*8)+12*1.28*10^9/(0.7*8)+5*2.56*10^8}{2Ghz} = 2.24s$$

加速比：
$$加速比_{2-1} = \frac{time_1}{time_2} = \frac{9.6s}{7.04s} \approx 1.36$$

$$加速比_{4-1} = \frac{time_1}{time_4} = \frac{9.6s}{3.84s} = 2.5$$

$$加速比_{8-1} = \frac{time_1}{time_8} = \frac{9.6s}{2.24s} \approx 4.28$$

#### 1.10.2
1:
$$time_1 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{2*2.56*10^9+12*1.28*10^9+5*2.56*10^8}{2Ghz} = 10.88s$$
时间变为1.13倍

2:
$$time_2 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{2*2.56*10^9/(0.7*2)+12*1.28*10^9/(0.7*2)+5*2.56*10^8}{2Ghz} \approx 7.94s$$
时间变为1.12倍

4:
$$time_4 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{2*2.56*10^9/(0.7*4)+12*1.28*10^9/(0.7*4)+5*2.56*10^8}{2Ghz} \approx 4.3s$$
时间变为1.12倍

8:
$$time_8 = \frac{\sum CPI \times 指令数}{时钟频率} = \frac{2*2.56*10^9/(0.7*8)+12*1.28*10^9/(0.7*8)+5*2.56*10^8}{2Ghz} \approx 2.46s$$
时间变为1.10倍

#### 1.10.3
设单核l/s的CPI降为x
$$ \frac{1*2.56*10^9+x*1.28*10^9+5*2.56*10^8}{2Ghz} = \frac{1*2.56*10^9/(0.7*4)+12*1.28*10^9/(0.7*4)+5*2.56*10^8}{2Ghz}$$
解得
$$ x = 3$$
$$ 3/12\times100\% = 25\%$$
- 综上所述，应该降为原来的25%

## 1.12
#### 1.12.1
$$CPI = \frac{执行时间}{指令数*时钟周期} = \frac{750s}{2.389*10^{12}*0.333ns} \approx 0.94$$

#### 1.12.2
$$SPECCeatio = \frac{参考时间}{执行时间} = \frac{9650s}{750s} \approx 12.87$$

#### 1.12.3
$$CPU时间=指令数*CPI*时钟周期时间$$
$$
CPU时间_{new} =指令数_{new}*CPI*时钟周期时间 
$$
$$
= 指令数*1.1*CPI*时钟周期时间
$$
$$=1.1*CPU时间$$
- 故CPU时间增加1.1倍

#### 1.12.4
$$CPU时间=指令数*CPI*时钟周期时间$$
$$
CPU时间_{new} =指令数_{new}*CPI_{new}*时钟周期时间 
$$
$$
= 指令数*1.1*CPI*1.05*时钟周期时间
$$
$$=1.155*CPU时间$$
- 故CPU时间增加1.155倍

#### 1.12.5
$$
CPU时间_{new} = 1.155*CPU时间 = 1.155*750 = 866.25
$$
$$
SPECCeatio_{new} = \frac{参考时间}{执行时间_{new}} = \frac{9650s}{866.25s} \approx 11.14
$$

#### 1.12.6
$$
CPU时间_{new} =指令数_{new}*CPI_{new}*时钟周期时间_{new} 
$$
$$
CPI_{new} = \frac{CPU时间_{new}}{时钟周期时间_{new}* 指令数_{new}} = \frac{700s}{1/4Ghz*2.389*10^{12}*0.85} \approx 1.38
$$

#### 1.12.7
$$CPI提升率 = \frac{1.38}{0.94} *100\% = 146.8\%$$
- 不相同
- 原因：新处理器可能采用了新指令，这些新指令虽然减少了总指令数，但可能需要更多的时钟周期来执行，频率的提高增加了处理器的性能，但也可能引入了更多的流水线停顿或缓存未命中的情况，这也能影响CPI。

#### 1.12.8
$$时间减少率=\frac{750-700}{750} *100\% \approx 6.67\%$$

#### 1.12.9
- 对于频率为3Ghz的处理器
$$
指令数 = \frac{CPU时间*时钟频率}{CPI} = \frac{960ns*3Ghz}{1.61} \approx 1789
$$
- 对于频率为4Ghz的处理器
$$
指令数 = \frac{CPU时间*时钟频率}{CPI} = \frac{960ns*0.9*4Ghz}{1.61} \approx 2146
$$

#### 1.12.10
- 此处使用时钟频率为4Ghz时计算出的指令数
$$
时钟频率 = \frac{指令数*CPI}{CPU时间} = \frac{2146*1.61}{960ns*0.81} \approx 4.4Ghz
$$

#### 1.12.11
- 此处使用时钟频率为4Ghz时计算出的指令数
$$
时钟频率 = \frac{指令数*CPI}{CPU时间} = \frac{2146*1.61*0.85}{960ns*0.8} \approx 3.82Ghz
$$

## 1.14
#### 1.14.1
$$
总时间减少量 = \frac{70*0.2}{250s}*100\% = 5.6\%
$$

#### 1.14.2
$$
整数操作时间 = 250-70-85-40 = 55s
$$
$$
总时间_{new}  = 250*0.8 = 200s
$$
$$
整数操作时间_{new} = 200-70-85-40 = 5s
$$
$$
整数操作时间减少量 = \frac{55s-5s}{55s}*100\% = 91\%
$$

#### 1.14.3
- $\because$即使分支指令不占用任何时间，总执行时间仍需要210s
- 又$\because$总时间减少20%需要减少至200秒
- $\therefore$因此仅减少分支指令时间无法使总时间减少20%

## 1.15
#### 1.15.1
- 设$CPI_{fnew}$为$x$
$$
\frac{50*10^6*1+110*10^6*1+80*10^6*4+16*10^6*2}{2Ghz}*0.5=\frac{50*10^6*x+110*10^6*1+80*10^6*4+16*10^6*2}{2Ghz}
$$
- 此方程无正数解
- 因此无论如何改进也不能提升2倍

#### 1.15.2
- 设$CPI_{LSnew}$为$x$
$$
\frac{50*10^6*1+110*10^6*1+80*10^6*4+16*10^6*2}{2Ghz}*0.5=\frac{50*10^6*1+110*10^6*1+80*10^6*x+16*10^6*2}{2Ghz}
$$
- 解得x=0.8
- 即L/S 指令的 CPI应改进到0.8

#### 1.15.3
$$CPUtime_{new} = \frac{50*10^6*1*0.6+110*10^6*1*0.6+80*10^6*4*0.7+16*10^6*2*0.7}{2Ghz} = 0.1712s$$
$$
CPUtime = \frac{50*10^6*1+110*10^6*1+80*10^6*4+16*10^6*2}{2Ghz} = 0.256s
$$
$$
减少量 = \frac{CPUtime-CPUtime_{new}}{CPUtime} = 33.125\%
$$
- 因此总执行时间减少33.125%

## 1.16
#### 2
$$time_2= \frac{t}{p}+4 = \frac{100}{2}+4 = 54s$$
$$实际加速比=\frac{time_1}{time_2} = \frac{100s}{54s} \approx 1.85$$
$$\frac{实际加速比}{理想加速比} = \frac{1.85}{2} = 0.925$$

#### 4
$$time_2= \frac{t}{p}+4 = \frac{100}{4}+4 = 29s$$
$$实际加速比=\frac{time_1}{time_2} = \frac{100s}{29s} \approx 3.45$$
$$\frac{实际加速比}{理想加速比} = \frac{1.85}{4} = 0.86$$

#### 8
$$time_2= \frac{t}{p}+4 = \frac{100}{8}+4 = 16.5s$$
$$实际加速比=\frac{time_1}{time_2} = \frac{100s}{16.5s} \approx 6.06$$
$$\frac{实际加速比}{理想加速比} = \frac{6.06}{8} = 0.76$$

#### 16
$$time_2= \frac{t}{p}+4 = \frac{100}{16}+4 = 10.25s$$
$$实际加速比=\frac{time_1}{time_2} = \frac{100s}{10.25s} \approx 9.76$$
$$\frac{实际加速比}{理想加速比} = \frac{9.76}{16} \approx 0.61$$

#### 32
$$time_2= \frac{t}{p}+4 = \frac{100}{32}+4 = 7.125s$$
$$实际加速比=\frac{time_1}{time_2} = \frac{100s}{7.125s} \approx 14.04$$
$$\frac{实际加速比}{理想加速比} = \frac{14.04}{32} \approx 0.44$$

#### 64
$$time_2= \frac{t}{p}+4 = \frac{100}{64}+4 = 5.56s$$
$$实际加速比=\frac{time_1}{time_2} = \frac{100s}{5.56s} \approx 17.99$$
$$\frac{实际加速比}{理想加速比} = \frac{17.99}{64} \approx 0.28$$

#### 128
$$time_2= \frac{t}{p}+4 = \frac{100}{128}+4 = 4.78s$$
$$实际加速比=\frac{time_1}{time_2} = \frac{100s}{4.78s} \approx 20.92$$
$$\frac{实际加速比}{理想加速比} = \frac{20.92}{128} \approx 0.16$$




